generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model AppConfig {
  guild_id String @id

  admin_password String?

  promocats_channel_id  String?
  promocats_post_time   DateTime?
  promocats_last_posted DateTime?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model User {
  id Int @id @default(autoincrement())

  discord_id String @unique

  avatar      String?
  //tag
  username    String?
  // guild username
  nickname    String?
  // displayed username
  global_name String?
  roles       String[]

  total_xp Int @default(0)
  level    Int @default(0)
  cookies  Int @default(0)

  voice_chat Int @default(0)

  // moderation
  banned_at DateTime?
  notes     String?

  meta Json @default(dbgenerated("'{}'::jsonb"))

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt
}

model Level {
  id Int @id @default(autoincrement())

  value Int @unique
  xp    Int

  role_add String
  role_del String
}

model Role {
  id   String @unique
  name String
}

model Channel {
  id             String          @id @unique
  name           String
  type           Int
  scheduledPosts ScheduledPost[]
}

model VoiceSession {
  user_id    String   @id @unique
  channel_id String   @unique
  started_at DateTime @default(now())
}

enum ScheduledPostStatus {
  SCHEDULED
  PROCESSING
  SENT
  CANCELLED
  FAILED
}

model ScheduledPostImage {
  id Int @id @default(autoincrement())

  path    String
  preview Bytes

  scheduledPost   ScheduledPost? @relation(fields: [scheduledPostId], references: [id])
  scheduledPostId Int?
}

model ScheduledPost {
  id Int @id @default(autoincrement())

  channel    Channel @relation(fields: [channel_id], references: [id])
  channel_id String

  text  String
  media ScheduledPostImage[]

  status ScheduledPostStatus @default(SCHEDULED)
  error  String?

  scheduled_at DateTime

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt
}

model PromoCat {
  id Int @id @default(autoincrement())

  promocode String
  discount  Int
  date      DateTime @unique
}

model PromoCatImage {
  name    String @unique
  preview Bytes
}
